<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>jQuery UI Draggable - Snap to element or grid</title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
    <script src="http://code.jquery.com/ui/1.10.0/jquery-ui.js"></script>
    <link rel="stylesheet" href="/lib/resources/css/application.css" />
    <style>
      .draggable { width: 130px; height: 120px; padding: 5px; float: left; margin: 0 10px 10px 0; font-size: .9em; }
      .dropped { width: 130px; height: 120px; padding: 5px; float: left; margin: 0 10px 10px 0; font-size: .9em; }
      .ui-widget-header p, .ui-widget-content p { margin: 0; }
      #snaptarget { height: 940px; width: 1000px; }
        .grid {width: 20px; height: 20px}
      table {
        text-align: center;
        margin: 0 auto;
        margin-top: 20px;
        /*margin-right: 100px;*/
      }
      tr {
        padding: 3px;
      }

      #tiles-container {
        width: 300px;
        height: 200px;
        background-color: #563616;
      }

      #mountain {
        background: url('/images/mountain.svg');
      }

      #mountain_1 {
        background: url('/images/mountain.svg');
      }

      #goldmine {
        background: url('/images/goldmine.png');
      }

      #dragon {
        background: url('/images/dragon.png');
      }

      #negativeSix {
        background: url('/images/6.png');
      }
      #positiveSix {
        background: url('/images/6.png');
      }
      #positiveSix_1 {
        background: url('/images/6.png');
      }

      #negativeFive {
        background: url('/images/5.jpg');
      }
      #positiveFive {
        background: url('/images/5.jpg');
      }
      #positiveFive_1 {
        background: url('/images/5.jpg');
      }

      #negativeFour {
        background: url('/images/4.jpg');
      }
      #positiveFour {
        background: url('/images/4.jpg');
      }
      #positiveFour_1 {
        background: url('/images/4.jpg');
      }

      #negativeThree {
        background: url('/images/3.jpg');
      }
      #positiveThree {
        background: url('/images/3.jpg');
      }
      #positiveThree_1 {
        background: url('/images/3.jpg');
      }

      #negativeTwo {
        background: url('/images/2.jpg');
      }
      #positiveTwo {
        background: url('/images/2.jpg');
      }
      #positiveTwo_1 {
        background: url('/images/2.jpg');
      }

      #negativeOne {
        background: url('/images/2.jpg');
      }
      #positiveOne {
        background: url('/images/2.jpg');
      }
      #positiveOne_1 {
        background: url('/images/2.jpg');
      }

      td {
        border-style: solid;
        border-color: black;
        border-width: 17px;
        background: url('/images/grass.jpg');
        padding-top: 118px;
        padding-left: 138px;
      }
      #castle-container {
        float: right;
        height: 300px;
        width: 200px;
        background-color: blue
      ;
      }

    </style>
    <script>
      app = {};

      $(function() {

        $("#new_game").button({text:false}).click(function() {
          console.log('clicked')
          numberOfPlayers();
          generateTiles();
          var tile = app.tiles.pop();
          $("#tiles-container").append("<div id='" + tile.name + "' class='draggable'><p>" + tile.name + "</p></div>")
          $("#tiles-container #" + tile.name + "").draggable({ revert: "invalid", containment: "document", cursor: "move"  });
        });
        $("#castle").button({text:false}).click(function() {
          console.log('clicked')
          selectCastle();


        });

        $("#tile").button({text:false}).click(function() {
          console.log('clicked')
          var tile = app.tiles.pop();
          $("#tiles-container").append("<div id='" + tile.name + "' class='draggable'><p>" + tile.name + "</p></div>")
          $("#tiles-container #" + tile.name + "").draggable({ revert: "invalid", containment: "document", cursor: "move"  });
        });

        $( "#dragon" ).draggable({ revert: "invalid", containment: "document", cursor: "move"  });
        $( "td.grid").droppable({accept: ".ui-draggable", drop: function( event, ui ) {
          $( "#dialog-confirm" ).dialog({
            resizable: false,
            height:140,
            modal: true,
            buttons: {
              "Finish": function() {
                $(".draggable4").removeClass('draggable').addClass('dropped');

                $( this ).dialog( "close" );
              },
              Cancel: function() {
                $( this ).dialog( "close" );
              }
            }
          });
        }});

      });
    </script>
  </head>
  <body>

    <div id="dialog-confirm" title="Finish Move?" class="hidden">
      <p><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span>Are you sure?</p>
    </div>

    <div id="number-players" title="Number Players?" class="hidden">
      <p><span style="float: left; margin: 0 7px 20px 0;"></span></p>
    </div>

    <div id="select-castle" title="Castle Multiplier?" class="hidden">
      <p><span style="float: left; margin: 0 7px 20px 0;"></span></p>
    </div>

    <div id="toolbar" class="ui-widget-header ui-corner-all">
      <button id="new_game">New Game</button>
      <button id="castle">Castle</button>
      <button id="tile">Tile</button>
    </div>


    <div id="snaptarget" class="ui-widget-header" style="float:left">
      <table>
        <tr>
          <td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td>
        </tr>
        <tr>
          <td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td>
        </tr>
        <tr>
          <td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td>
        </tr>
        <tr>
          <td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td>
        </tr>
        <tr>
          <td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td><td class='grid'></td>
        </tr>
      </table>
    </div>
    <div id="castle-container" style="float:right;">
    </div>

    <br style="clear: both;" />

    <div id="tiles-container">
      <!--<div id="dragon" class="draggable">-->
        <!--<p>Dragon</p>-->
      <!--</div>-->
    </div>


    <script>
      function generateTiles() {
        var randomNumbers = this.generateRandomNumbers();

        $.each(tiles, function(index, tile) {
          tile['random'] = randomNumbers[index];
        });

        tiles.sort(function(a,b) {
          return a.random - b.random
        });
        app.tiles = tiles;
      }

      function generateRandomNumbers() {
        var arr = [];
        while(arr.length < 22) {
          var randomNumber = Math.ceil(Math.random()*100);
          var found = false;
          for (var i=0; i < arr.length; i++) {
            if (arr[i] == randomNumber){found=true;break}
          }
          if (!found) arr[arr.length]=randomNumber;
        }
        return arr;
      }

      function numberOfPlayers() {
        $( "#number-players").dialog({
          resizable: false,
          height:140,
          modal: true,
          buttons: {
            "2": function() {
              app.playerCastles = {red: {castles: redCastles}, blue: {castles :blueCastles}};
              $( this ).dialog( "close" );
            },
            "3": function() {
              app.playerCastles = {red: {castles: redCastles}, blue: {castles :blueCastles}, yellow: {castles: yellowCastles}};
              $( this ).dialog( "close" );
            },
            "4": function() {
              app.playerCastles = {red: {castles: redCastles}, blue: {castles :blueCastles}, yellow: {castles: yellowCastles}, green: {castles: greenCastles}};
              $( this ).dialog( "close" );
            }
          }
        });
      }

      function selectCastle() {
        $( "#select-castle").dialog({
          resizable: false,
          height:140,
          modal: true,
          buttons: {
            "1": function() {
              var player = getCurrentPlayer();
              var castles = app.playerCastles[player].castles;
              var castle;
              for (var i=0; i<castles.length; i++) {
                if (castles[i].value === '1') {
                  castle = castles[i];
                  var tmp = [];
                  for (var j=0; j<castles.length; j++) {
                    if (castles[j].id != castle.id)
                    tmp.push(castles[j])
                  }
                  app.playerCastles[player].castles = tmp;
                  break
                }
              }
              $( this ).dialog( "close" );
              $("#castle-container").append("<div id='" + castle.name + "' class='draggable'><p>" + castle.name + "</p></div>")
              $("#castle-container #" + castle.name + "").draggable({ revert: "invalid", containment: "document", cursor: "move"  });
            },
            "2": function() {
              var player = getCurrentPlayer();
              var castles = app.playerCastles[player].castles;
              var castle;
              for (var i=0; i<castles.length; i++) {
                if (castles[i].value === '2') {
                  castle = castles[i];
                  var tmp = [];
                  for (var j=0; j<castles.length; j++) {
                    if (castles[j].id != castle.id)
                      tmp.push(castles[j])
                  }
                  app.playerCastles[player].castles = tmp;
                  break
                }
              }
              $( this ).dialog( "close" );
              $("#castle-container").append("<div id='" + castle.name + "' class='draggable'><p>" + castle.name + "</p></div>")
              $("#castle-container #" + castle.name + "").draggable({ revert: "invalid", containment: "document", cursor: "move"  });
            },
            "3": function() {
              var player = getCurrentPlayer();
              var castles = app.playerCastles[player].castles;
              var castle;
              for (var i=0; i<castles.length; i++) {
                if (castles[i].value === '3') {
                  castle = castles[i];
                  var tmp = [];
                  for (var j=0; j<castles.length; j++) {
                    if (castles[j].id != castle.id)
                      tmp.push(castles[j])
                  }
                  app.playerCastles[player].castles = tmp;
                  break
                }
              }
              $( this ).dialog( "close" );
              $("#castle-container").append("<div id='" + castle.name + "' class='draggable'><p>" + castle.name + "</p></div>")
              $("#castle-container #" + castle.name + "").draggable({ revert: "invalid", containment: "document", cursor: "move"  });
            },
            "4": function() {
              var player = getCurrentPlayer();
              var castles = app.playerCastles[player].castles;
              var castle;
              for (var i=0; i<castles.length; i++) {
                if (castles[i].value === '4') {
                  castle = castles[i];
                  var tmp = [];
                  for (var j=0; j<castles.length; j++) {
                    if (castles[j].id != castle.id)
                      tmp.push(castles[j])
                  }
                  app.playerCastles[player].castles = tmp;
                  break
                }
              }
              $( this ).dialog( "close" );
              $("#castle-container").append("<div id='" + castle.name + "' class='draggable'><p>" + castle.name + "</p></div>")
              $("#castle-container #" + castle.name + "").draggable({ revert: "invalid", containment: "document", cursor: "move"  });
            }
          }
        });
      }



      function getCurrentPlayer() {
        return 'red'
      }

      // this doesn't work, color is always set to the last color
      function generateCastles(players) {
        var playerCastles = [];
        var colors = ['red', 'green', 'blue', 'yellow'];
        for (var i=0; i < players; i++) {
          var color = colors[i];
          for(var j = 0; j< castles.length; j++) {
            var castle = castles[j];
            castle['color'] = color;
          }
          playerCastles.push({color: color, castles: castles});
        }
        return playerCastles
      }

      var redCastles = [
        {
          id    : 0,
          name  : 'oneCastle',
          value : '1',
          color : 'red'
        },
        {
          id    : 1,
          name  : 'oneCastle_1',
          value : '1',
          color : 'red'
        },
        {
          id    : 2,
          name  : 'oneCastle_2',
          value : '1',
          color : 'red'
        },
        {
          id    : 3,
          name  : 'oneCastle_3',
          value : '1',
          color : 'red'
        },
        {
          id    : 4,
          name  : 'twoCastle',
          value : '2',
          color : 'red'
        },
        {
          id    : 5,
          name  : 'twoCastle_1',
          value : '2',
          color : 'red'
        },
        {
          id    : 6,
          name  : 'twoCastle_2',
          value : '2',
          color : 'red'
        },
        {
          id    : 7,
          name  : 'threeCastle',
          value : '3',
          color : 'red'
        },
        {
          id    : 8,
          name  : 'threeCastle_1',
          value : '3',
          color : 'red'
        },
        {
          id    : 9,
          name  : 'fourCastle',
          value : '4',
          color : 'red'
        }
      ];

      var blueCastles = [
        {
          id    : 0,
          name  : 'oneCastle',
          value : '1',
          color : 'blue'
        },
        {
          id    : 2,
          name  : 'oneCastle_1',
          value : '1',
          color : 'blue'
        },
        {
          id    : 1,
          name  : 'oneCastle_2',
          value : '1',
          color : 'blue'
        },
        {
          id    : 3,
          name  : 'oneCastle_3',
          value : '1',
          color : 'blue'
        },
        {
          id    : 4,
          name  : 'twoCastle',
          value : '2',
          color : 'blue'
        },
        {
          id    : 5,
          name  : 'twoCastle_1',
          value : '2',
          color : 'blue'
        },
        {
          id    : 6,
          name  : 'twoCastle_2',
          value : '2',
          color : 'blue'
        },
        {
          id    : 7,
          name  : 'threeCastle',
          value : '3',
          color : 'blue'
        },
        {
          id    : 8,
          name  : 'threeCastle_1',
          value : '3',
          color : 'blue'
        },
        {
          id    : 9,
          name  : 'fourCastle',
          value : '4',
          color : 'blue'
        }
      ];

      var yellowCastles = [
        {
          id    : 0,
          name  : 'oneCastle',
          value : '1',
          color : 'yellow'
        },
        {
          id    : 1,
          name  : 'oneCastle_1',
          value : '1',
          color : 'yellow'
        },
        {
          id    : 2,
          name  : 'oneCastle_2',
          value : '1',
          color : 'yellow'
        },
        {
          id    : 3,
          name  : 'oneCastle_3',
          value : '1',
          color : 'yellow'
        },
        {
          id    : 4,
          name  : 'twoCastle',
          value : '2',
          color : 'yellow'
        },
        {
          id    : 5,
          name  : 'twoCastle_1',
          value : '2',
          color : 'yellow'
        },
        {
          id    : 6,
          name  : 'twoCastle_2',
          value : '2',
          color : 'yellow'
        },
        {
          id    : 7,
          name  : 'threeCastle',
          value : '3',
          color : 'yellow'
        },
        {
          id    : 8,
          name  : 'threeCastle_1',
          value : '3',
          color : 'yellow'
        },
        {
          id    : 9,
          name  : 'fourCastle',
          value : '4',
          color : 'yellow'
        }
      ];

      var greenCastles = [
        {
          id    : 0,
          name  : 'oneCastle',
          value : '1',
          color : 'green'
        },
        {
          id    : 1,
          name  : 'oneCastle_1',
          value : '1',
          color : 'green'
        },
        {
          id    : 2,
          name  : 'oneCastle_2',
          value : '1',
          color : 'green'
        },
        {
          id    : 3,
          name  : 'oneCastle_3',
          value : '1',
          color : 'green'
        },
        {
          id    : 4,
          name  : 'twoCastle',
          value : '2',
          color : 'green'
        },
        {
          id    : 5,
          name  : 'twoCastle_1',
          value : '2',
          color : 'green'
        },
        {
          id    : 6,
          name  : 'twoCastle_2',
          value : '2',
          color : 'green'
        },
        {
          id    : 7,
          name  : 'threeCastle',
          value : '3',
          color : 'green'
        },
        {
          id    : 8,
          name  : 'threeCastle_1',
          value : '3',
          color : 'green'
        },
        {
          id    : 9,
          name  : 'fourCastle',
          value : '4',
          color : 'green'
        }
      ];


      var tiles  = [
        {
          id     : 0,
          name   : 'positiveSix',
          icon   : 'images/6.png',
          value  : '6',
          text   : '+6',
          random : 1,
          status : 'store'
        },
        {
          id     : 1,
          name   : 'positiveSix_1',
          icon   : 'images/6.png',
          value  : '6',
          text   : '+6',
          random : 1,
          status : 'store'
        },
        {
          id     : 2,
          name   : 'positiveFive',
          icon   : 'images/5.jpg',
          value  : '5',
          text   : '+5',
          random : 1,
          status : 'store'
        },
        {
          id     : 3,
          name   : 'positiveFive_1',
          icon   : 'images/5.jpg',
          value  : '5',
          text   : '+5',
          random : 1,
          status : 'store'
        },
        {
          id     : 4,
          name   : 'positiveFour',
          icon   : 'images/4.jpg',
          value  : '4',
          text   : '+4',
          random : 1,
          status : 'store'
        },
        {
          id     : 5,
          name   : 'positiveFour_1',
          icon   : 'images/4.jpg',
          value  : '4',
          text   : '+4',
          random : 1,
          status : 'store'
        },
        {
          id     : 6,
          name   : 'positiveThree',
          icon   : 'images/3.jpg',
          value  : '3',
          text   : '+3',
          random : 1,
          status : 'store'
        },
        {
          id     : 7,
          name   : 'positiveThree_1',
          icon   : 'images/3.jpg',
          value  : '3',
          text   : '+3',
          random : 1,
          status : 'store'
        },
        {
          id     : 8,
          name   : 'positiveTwo',
          icon   : 'images/2.jpg',
          value  : '2',
          text   : '+2',
          random : 1,
          status : 'store'
        },
        {
          id     : 9,
          name   : 'positiveTwo_1',
          icon   : 'images/2.jpg',
          value  : '2',
          text   : '+2',
          random : 1,
          status : 'store'
        },
        {
          id     : 10,
          name   : 'positiveOne',
          icon   : 'images/1.jpg',
          value  : '1',
          text   : '+1',
          random : 1,
          status : 'store'
        },
        {
          id     : 11,
          name   : 'positiveOne_1',
          icon   : 'images/1.jpg',
          value  : 1,
          text   : '+1',
          random : 1,
          status : 'store'
        },
        {
          id     : 12,
          name   : 'negativeOne',
          icon   : 'images/1.jpg',
          value  : -1,
          text   : '-1',
          random : 1,
          status : 'store'
        },
        {
          id     : 13,
          name   : 'negativeTwo',
          icon   : 'images/2.jpg',
          value  : -2,
          text   : '-2',
          random : 1,
          status : 'store'
        },
        {
          id     : 14,
          name   : 'negativeThree',
          icon   : 'images/3.jpg',
          value  : -3,
          text   : '-3',
          random : 1,
          status : 'store'
        },
        {
          id     : 15,
          name   : 'negativeFour',
          icon   : 'images/4.jpg',
          value  : -4,
          text   : '-4',
          random : 1,
          status : 'store'
        },
        {
          id     : 16,
          name   : 'negativeFive',
          icon   : 'images/5.jpg',
          value  : -5,
          text   : '-5',
          random : 1,
          status : 'store'
        },
        {
          id     : 17,
          name   : 'negativeSix',
          icon   : 'images/6.png',
          value  : -6,
          text   : '-6',
          random : 1,
          status : 'store'
        },
        {
          id     : 18,
          name   : 'dragon',
          icon   : 'images/dragon.png',
          value  : 0,
          text   : 'Dragon',
          random : 1,
          status : 'store'
        },
        {
          id     : 19,
          name   : 'goldMine',
          icon   : 'images/goldmine.png',
          value  : 0,
          text   : 'Gold<br/>Mine',
          random : 1,
          status : 'store'
        },
        {
          id     : 20,
          name   : 'mountain',
          icon   : 'images/mountain.svg',
          value  : 0,
          text   : 'Mountain',
          random : 1,
          status : 'store'
        },
        {
          id     : 21,
          name   : 'mountain_1',
          icon   : 'images/mountain.svg',
          value  : 0,
          text   : 'Mountain',
          random : 1,
          status : 'store'
        }
      ];
    </script>

  </body>
</html>